{
    "全局脚本": "// 全局辅助函数\n\n// 战斗系统\nfunction 战斗($目标) {\n    $当前位置 = $_SESSION[\"游戏状态\"][\"当前位置\"];\n    $攻击力 = $_SESSION[\"游戏状态\"][\"攻击力\"];\n    \n    if ($目标 === \"狼\" && $当前位置 === \"森林深处\") {\n        $成功率 = 70 + $攻击力;\n        if (rand(1, 100) <= $成功率) {\n            $结果 = \"你成功击败了狼！\";\n            $结果 .= 添加物品(\"狼牙\");\n            $_SESSION[\"游戏状态\"][\"分数\"] += 100;\n            $_SESSION[\"游戏状态\"][\"生命值\"] -= 15;\n        } else {\n            $结果 = \"狼躲开了你的攻击并反击！\";\n            $_SESSION[\"游戏状态\"][\"生命值\"] -= 30;\n            \n            if ($_SESSION[\"游戏状态\"][\"生命值\"] <= 0) {\n                $结果 .= \"\\n你被狼击败了！村民们发现并救了你。\";\n                初始化游戏();\n                $_SESSION[\"游戏状态\"][\"生命值\"] = 50;\n                $_SESSION[\"游戏状态\"][\"背包\"] = [];\n            }\n        }\n        return $结果;\n    }\n    return \"这里没有可以攻击的{$目标}。\";\n}\n\nfunction 人物交谈($人物) {\n    $当前位置 = $_SESSION[\"游戏状态\"][\"当前位置\"];\n    $游戏世界 = $_SESSION[\"游戏世界\"];\n    \n    // 检查当前场景是否有自定义对话\n    if (isset($游戏世界[\"地图\"][$当前位置][\"人物\"][$人物])) {\n        switch ($人物) {\n            case \"村长\":\n                if (!isset($_SESSION[\"游戏状态\"][\"任务\"])) {\n                    $响应 = \"村长说：\\\"最近森林里的狼越来越猖獗了，你能帮我们解决这个问题吗？\\\"\";\n                    $_SESSION[\"游戏状态\"][\"任务\"] = \"调查森林狼群\";\n                } elseif ($_SESSION[\"游戏状态\"][\"任务\"] === \"调查森林狼群\" && 物品在背包中(\"狼牙\")) {\n                    $响应 = \"村长激动地说：\\\"你解决了狼群问题！这是给你的奖励 - 村庄通行证。\\\"\";\n                    添加物品(\"通行证\");\n                    $_SESSION[\"游戏状态\"][\"分数\"] += 200;\n                    $_SESSION[\"游戏状态\"][\"任务\"] = \"已获得通行证\";\n                } else {\n                    $响应 = \"村长说：\\\"记得帮我们解决森林里的狼群问题。\\\"\";\n                }\n                return $响应;\n            case \"铁匠\":\n                if (物品在背包中(\"黄金项链\")) {\n                    $响应 = \"铁匠眼睛一亮：\\\"这条项链我可以帮你重新打造！\\\"他用项链打造了一把宝剑给你。\";\n                    $_SESSION[\"游戏状态\"][\"背包\"] = array_diff($_SESSION[\"游戏状态\"][\"背包\"], [\"黄金项链\"]);\n                    $_SESSION[\"游戏状态\"][\"背包\"][] = \"宝剑\";\n                    $_SESSION[\"游戏状态\"][\"攻击力\"] += 25;\n                } else {\n                    $响应 = \"铁匠说：\\\"如果你找到什么值钱的东西，我可以帮你打造更好的武器。\\\"\";\n                }\n                return $响应;\n            case \"酒保\":\n                return \"酒保擦着杯子说：\\\"楼上的客人昨天丢了一把钥匙，如果你找到可以留着。\\\"\";\n            default:\n                return \"{$人物}看了你一眼，没有说什么。\";\n        }\n    }\n    \n    return \"{$人物}看了你一眼，没有说什么。\";\n}\n\n// 初始化游戏\nif (!isset($_SESSION[\"游戏状态\"])) {\n    $_SESSION[\"游戏状态\"] = [\n        \"当前位置\" => \"村庄广场\",\n        \"背包\" => [\"小刀\"],\n        \"生命值\" => 100,\n        \"攻击力\" => 5,\n        \"分数\" => 0,\n        \"已访问地点\" => [\"村庄广场\" => true],\n        \"任务\" => \"\",\n        \"洞穴已照亮\" => false\n    ];\n}",
    "地图": {
        "村庄广场": {
            "描述": "你站在一个宁静的村庄广场上，鹅卵石铺就的地面被岁月打磨得光滑。东面是铁匠铺，传来叮叮当当的打铁声；西面有一家小酒馆，飘出食物的香气；北边是一条通往森林的小路；南边是村口大门。",
            "出口": {
                "东": "铁匠铺",
                "西": "小酒馆",
                "北": "森林入口",
                "南": "村口大门"
            },
            "物品": [
                "旧报纸"
            ],
            "人物": {
                "村长": "一位白发苍苍的老人正在广场中央的长椅上休息"
            },
            "脚本": "if (isset($_SESSION[\"游戏状态\"][\"任务\"])) {\n    switch ($_SESSION[\"游戏状态\"][\"任务\"]) {\n        case \"调查森林狼群\":\n            echo \"\\n村长看起来忧心忡忡，似乎想和你说话。\";\n            break;\n        case \"已获得通行证\":\n            echo \"\\n村长对你微笑点头，显然对你的表现很满意。\";\n            break;\n    }\n}"
        },
        "铁匠铺": {
            "描述": "铁匠铺内炉火正旺，墙上挂满了各种武器和工具。铁匠看到你进来，擦了擦额头的汗水。角落里有一个上锁的箱子。",
            "出口": {
                "西": "村庄广场"
            },
            "物品": [
                "铁锤"
            ],
            "人物": {
                "铁匠": "一位肌肉发达的中年男子，正用钳子夹着一块烧红的铁"
            },
            "特殊": "需要钥匙打开铁匠的箱子",
            "脚本": "if (物品在背包中(\"黄金项链\")) {\n    echo \"\\n铁匠不时瞥向你，似乎对你的项链很感兴趣。\";\n}"
        },
        "铁匠铺后院": {
            "描述": "这是铁匠铺的后院，堆满了各种金属废料和工具。地上有一个闪闪发光的东西。",
            "出口": {
                "西": "酒馆二楼",
                "东": "铁匠铺"
            },
            "物品": [
                "金属碎片"
            ],
            "特殊": "从这里的后门可以进入铁匠铺",
            "脚本": "if (!物品在背包中(\"金属碎片\")) {\n    echo \"\\n阳光照在金属废料堆上，有什么东西在反光。\";\n}"
        },
        "小酒馆": {
            "描述": "酒馆里弥漫着麦酒和烤肉的味道，几张木桌旁坐着几个村民。吧台后面站着酒保，墙上贴着一张悬赏令。",
            "出口": {
                "东": "村庄广场",
                "上": "酒馆二楼"
            },
            "物品": [
                "空酒杯"
            ],
            "人物": {
                "酒保": "一个秃顶的胖男人，正在擦拭酒杯"
            },
            "脚本": "if (!isset($_SESSION[\"游戏状态\"][\"已访问地点\"][\"酒馆二楼\"])) {\n    echo \"\\n酒保偶尔抬头看向二楼，似乎在担心什么。\";\n}"
        },
        "酒馆二楼": {
            "描述": "这是酒馆的二楼客房，有几间简陋的房间。走廊尽头有一扇窗户可以看到外面的景色。",
            "出口": {
                "下": "小酒馆"
            },
            "物品": [
                "破旧的钥匙"
            ],
            "特殊": "从窗户可以看到铁匠铺的后院",
            "脚本": "if (!物品在背包中(\"破旧的钥匙\")) {\n    echo \"\\n窗户边的地板上有什么东西在闪闪发光。\";\n}"
        },
        "森林入口": {
            "描述": "茂密的森林边缘，树木高大挺拔。一条小路蜿蜒伸入林中，路边立着一块警告牌。远处传来奇怪的鸟叫声。",
            "出口": {
                "南": "村庄广场",
                "北": "森林深处"
            },
            "物品": [
                "松果"
            ],
            "特殊": "警告牌上写着\"危险！有狼出没！\"",
            "脚本": "if ($_SESSION[\"游戏状态\"][\"任务\"] === \"调查森林狼群\") {\n    echo \"\\n警告牌上的字迹看起来是最近才写的。\";\n}"
        },
        "森林深处": {
            "描述": "森林深处光线昏暗，空气中弥漫着潮湿的泥土气息。你注意到地上有一些奇怪的脚印。",
            "出口": {
                "南": "森林入口",
                "东": "神秘洞穴"
            },
            "物品": [
                "草药"
            ],
            "特殊": "需要火把才能进入洞穴",
            "脚本": "if (!物品在背包中(\"火把\")) {\n    echo \"\\n洞穴入口黑漆漆的，看起来需要光源才能进入。\";\n} else {\n    echo \"\\n火把的光亮足以让你看清洞穴入口。\";\n}"
        },
        "神秘洞穴": {
            "描述": "洞穴入口狭窄潮湿，洞壁上长满了发光的苔藓，提供了微弱的光亮。深处传来滴水的声音。",
            "出口": {
                "西": "森林深处",
                "内": "洞穴深处"
            },
            "物品": [
                "发光苔藓"
            ],
            "特殊": "洞穴深处似乎有什么东西在反光",
            "脚本": "if (物品在背包中(\"火把\")) {\n    echo \"\\n火把的光芒照亮了整个洞穴，比苔藓的光亮多了。\";\n}"
        },
        "洞穴深处": {
            "描述": "洞穴在这里扩大成一个圆形空间，中央有一个小水潭。水潭对面有一个古老的宝箱。",
            "出口": {
                "外": "神秘洞穴"
            },
            "物品": [
                "黄金项链"
            ],
            "特殊": "宝箱上刻着奇怪的符文",
            "脚本": "if (!物品在背包中(\"黄金项链\")) {\n    echo \"\\n宝箱上的符文似乎在警告着什么。\";\n}"
        },
        "村口大门": {
            "描述": "这是村庄的主要出入口，有两名卫兵在站岗。大门外是一条通往远方城市的土路。",
            "出口": {
                "北": "村庄广场"
            },
            "人物": {
                "卫兵甲": "一个满脸胡茬的中年男子，靠在门柱上打瞌睡",
                "卫兵乙": "年轻的小伙子，警惕地观察着四周"
            },
            "特殊": "卫兵不会让没有通行证的人离开村庄",
            "脚本": "if (物品在背包中(\"通行证\")) {\n    echo \"\\n卫兵乙看到你手中的通行证，对你点了点头。\";\n} else {\n    echo \"\\n卫兵乙警惕地盯着你，手放在剑柄上。\";\n}"
        }
    },
    "数据": {
        "物品数据": {
            "破旧的钥匙": {
                "拾取效果": "return \"你获得了破旧的钥匙，这可能是打开铁匠铺箱子的钥匙！\";",
                "使用效果": "if ($_SESSION[\"游戏状态\"][\"当前位置\"] === \"铁匠铺\") {\n    添加物品(\"短剑\");\n    $_SESSION[\"游戏状态\"][\"攻击力\"] += 10;\n    return \"你用钥匙打开了铁匠的箱子，发现里面有一把锋利的短剑！ 攻击力：\";\n}\nreturn \"这把钥匙在这里似乎没什么用。\";",
                "最大数量": 1,
                "使用次数": 1
            },
            "旧报纸": {
                "最大数量": 1,
                "使用次数": 1
            },
            "黄金项链": {
                "拾取效果": "$_SESSION[\"游戏状态\"][\"分数\"] += 500;\nreturn \"你获得了闪闪发光的黄金项链！这看起来值不少钱。\";",
                "使用效果": "if ($_SESSION[\"游戏状态\"][\"当前位置\"] === \"铁匠铺\") {\n    移除物品(\"黄金项链\");\n    添加物品(\"宝剑\");\n    $_SESSION[\"游戏状态\"][\"攻击力\"] += 25;\n    return \"铁匠用你的项链打造了一把锋利的宝剑！\";\n}\nreturn \"这条项链看起来很有价值，也许可以找铁匠做点什么。\";",
                "最大数量": 1,
                "使用次数": 1
            },
            "草药": {
                "拾取效果": "return \"你采集了一些草药，可以恢复生命值。\";",
                "使用效果": "$_SESSION[\"游戏状态\"][\"生命值\"] = min(100, $_SESSION[\"游戏状态\"][\"生命值\"] + 20);\n移除物品(\"草药\");\nreturn \"你使用了草药，恢复了20点生命值！\";",
                "最大数量": 3,
                "使用次数": null
            },
            "火把": {
                "使用效果": "if ($_SESSION[\"游戏状态\"][\"当前位置\"] === \"森林深处\") {\n    $_SESSION[\"游戏状态\"][\"洞穴已照亮\"] = true;\n    return \"你点燃了火把，现在可以进入洞穴了。\";\n}\nreturn \"火把在这里没什么用处。\";",
                "最大数量": 1,
                "使用次数": null
            }
        }
    }
}